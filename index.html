<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aidoe Disease Detection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="logo">ðŸ§¬ AidoeAI</div>
        <h1>Aidoe Disease Detection</h1>
        <button class="contact-button">Contact Me</button>
    </header>

    <main>
        <div class="upload-section">
            <button onclick="startWebcam()">Use Webcam</button>
            <input type="file" id="imageUpload" accept="image/*" style="display:none"
                onchange="handleImageUpload(event)" />
            <button onclick="document.getElementById('imageUpload').click()">Upload Image</button>
        </div>

        <div class="result">
            <canvas id="frameCanvas" width="224" height="224"></canvas>
            <p id="predictionText">Prediction will appear here.</p>
        </div>

        <div class="disclaimer">
            <p><strong>Disclaimer:</strong> This tool is for educational purposes only and does not replace professional
                medical advice or diagnosis.</p>
        </div>
    </main>

    <footer>
        <p>Follow us on</p>
        <div class="social-icons">
            <i class="fab fa-twitter"></i>
            <i class="fab fa-linkedin"></i>
            <i class="fab fa-github"></i>
        </div>
    </footer>
</body>
<script>
    const canvas = document.getElementById('frameCanvas');
    const ctx = canvas.getContext('2d');
    const predictionText = document.getElementById('predictionText');

    function sendImageToServer(blob) {
        const formData = new FormData();
        formData.append('image', blob, 'frame.jpg');

        function sendImageToServer(blob) {
            const formData = new FormData();
            formData.append('image', blob, 'frame.jpg');

            fetch('https://jaundice-backend-99m0.onrender.com/predict', {
                method: 'POST',
                body: formData
            })
                .then(async res => {
                    const contentType = res.headers.get("content-type");
                    if (!res.ok) {
                        const text = await res.text();
                        throw new Error(`Server error: ${text}`);
                    }
                    if (contentType && contentType.includes("application/json")) {
                        return res.json();
                    } else {
                        throw new Error("Expected JSON response, got something else.");
                    }
                })
                .then(data => {
                    predictionText.innerText = `Result: ${data.result}`;
                })
                .catch(err => {
                    predictionText.innerText = "Error predicting image.";
                    console.error("Prediction error:", err);
                });
        }
    }
    function startWebcam() {
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                video.addEventListener('loadeddata', () => {
                    ctx.drawImage(video, 0, 0, 224, 224);
                    canvas.toBlob(blob => {
                        sendImageToServer(blob);
                        stream.getTracks().forEach(track => track.stop());
                    }, 'image/jpeg');
                });
            })
            .catch(err => console.error("Webcam error:", err));
    }

    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const img = new Image();
        const reader = new FileReader();
        reader.onload = e => {
            img.onload = () => {
                ctx.drawImage(img, 0, 0, 224, 224);
                canvas.toBlob(blob => {
                    sendImageToServer(blob);
                }, 'image/jpeg');
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
</script>

</html>